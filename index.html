<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پخش اذان خودکار بر اساس مختصات تهران</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: center;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .prayer-times {
            margin-top: 20px;
        }
        .time-box {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>پخش اذان خودکار</h1>
    <p>زمان اذان ظهر و مغرب به طور خودکار نمایش داده شده و پخش خواهد شد.</p>

    <!-- نمایش زمان اذان ها -->
    <div class="prayer-times">
        <div class="time-box">اذان ظهر: <span id="zuhr-time">در حال بارگذاری...</span></div>
        <div class="time-box">اذان مغرب: <span id="maghrib-time">در حال بارگذاری...</span></div>
    </div>

    <!-- فایل صوتی اذان -->
    <audio id="azan-audio" src="https://github.com/dabaghi/azan-test/blob/main/azan-audio.mp3?raw=true"></audio>

    <script>
        // تابع دریافت زمان‌های اذان از API بر اساس مختصات جغرافیایی
        function getPrayerTimes() {
            const latitude = 35.6892;  // عرض جغرافیایی تهران
            const longitude = 51.3890;  // طول جغرافیایی تهران
            const method = 8;  // روش محاسبه (شیعه جعفری)

            return fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=${method}`)
                .then(response => response.json())
                .then(data => {
                    const prayerTimes = data.data.timings;
                    return {
                        zuhrTime: prayerTimes.Dhuhr,
                        maghribTime: prayerTimes.Maghrib
                    };
                })
                .catch(error => {
                    console.error('Error fetching prayer times:', error);
                    return null;
                });
        }

        // تابع بررسی زمان اذان و پخش فایل صوتی
        function checkAndPlayAzan(prayerTimes) {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            // اگر زمان فعلی با زمان اذان ظهر یا مغرب مطابقت داشت
            if (currentTime === prayerTimes.zuhrTime || currentTime === prayerTimes.maghribTime) {
                document.getElementById('azan-audio').play();
                new Notification("اذان", { body: "زمان اذان است!" });
            }
        }

        // درخواست نوتیفیکیشن از کاربر
        if (Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // بارگذاری زمان‌های اذان و نمایش آنها روی صفحه
        async function loadPrayerTimes() {
            const prayerTimes = await getPrayerTimes();
            if (prayerTimes) {
                // نمایش زمان‌های اذان در HTML
                document.getElementById('zuhr-time').textContent = prayerTimes.zuhrTime;
                document.getElementById('maghrib-time').textContent = prayerTimes.maghribTime;

                // بررسی هر دقیقه برای پخش اذان
                setInterval(() => {
                    checkAndPlayAzan(prayerTimes);
                }, 60000);  // بررسی هر 60 ثانیه
            }
        }

        // بارگذاری زمان‌های اذان در بدو شروع صفحه
        loadPrayerTimes();
    </script>
</body>
</html>
